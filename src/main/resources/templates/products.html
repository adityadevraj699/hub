<html lang="en" th:replace="base :: layout(~{::section})">
<section class="py-5" style="background: #f4f6f8;">
  <div class="container">

    <!-- Title -->
    <h2 class="mb-4 text-center fw-bold" style="letter-spacing:1px;">All Products</h2>

    <!-- Filter Form -->
    <form method="get" class="row g-3 mb-5">
      <div class="col-md-4">
        <input type="text" name="keyword" class="form-control" placeholder="Search">
      </div>
      <div class="col-md-3">
        <select name="categoryId" class="form-select">
          <option value="">All Categories</option>
          <th:block th:each="cat : ${categories}">
            <option th:value="${cat.id}" th:text="${cat.name}"></option>
          </th:block>
        </select>
      </div>
      <div class="col-md-2">
        <input type="number" name="minPrice" class="form-control" placeholder="Min">
      </div>
      <div class="col-md-2">
        <input type="number" name="maxPrice" class="form-control" placeholder="Max">
      </div>
      <div class="col-md-1 d-grid">
        <button class="btn btn-gradient">Filter</button>
      </div>
    </form>

    <!-- Products Grid -->
    <div class="row g-4 justify-content-center">
      <div class="col-lg-3 col-md-4 col-sm-6" th:each="product : ${products}">
        <div class="card product-card h-100 text-center shadow-sm">
          <div class="position-relative">
            <img th:src="@{${product.image}}" class="card-img-top product-image" alt="Product" />

            <!-- Wishlist Heart -->
            <span class="position-absolute top-0 end-0 m-2 fs-4">
              <a th:if="${currentUser != null}" th:href="@{/wishlist/toggle/{id}(id=${product.id})}" class="text-danger">
                <i class="fa" th:classappend="${product.isInWishlist} ? 'fa-heart' : 'fa-heart-o'"></i>
              </a>
              <a th:if="${currentUser == null}" th:href="@{/login}" class="text-danger">
                <i class="fa" th:classappend="${product.isInWishlist} ? 'fa-heart' : 'fa-heart-o'"></i>
              </a>
            </span>
          </div>

          <div class="card-body d-flex flex-column">
            <h5 class="card-title fw-bold" th:text="${product.name}"></h5>
            <p class="card-text text-truncate" th:text="${product.description}"></p>
            <p class="fw-bold text-primary fs-5">$<span th:text="${product.price}"></span></p>

            <form th:action="@{/checkout/single/{id}(id=${product.id})}" method="get" class="mt-2">
              <input type="hidden" name="quantity" value="1" />
              <button type="submit" class="btn btn-gradient w-100 mb-2">Buy Now</button>
            </form>

            <a th:href="@{/products/{id}(id=${product.id})}" class="btn btn-outline-info w-100">View Details</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Bootstrap + FontAwesome ===== -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

  <style>
    /* ---------- Card & Image ---------- */
    .product-card {
      border-radius: 16px;
      overflow: hidden;
      transition: transform 0.4s, box-shadow 0.4s;
      background: #fff;
    }

    .product-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.15);
    }

    .product-image {
      height: 250px;
      object-fit: cover;
      width: 100%;
      transition: transform 0.4s ease;
    }

    .product-card:hover .product-image {
      transform: scale(1.05);
    }

    /* ---------- Buttons ---------- */
    .btn-gradient {
      background: linear-gradient(90deg, #ff6a00, #ee0979);
      color: #fff;
      border: none;
      border-radius: 30px;
      padding: 0.6rem 1.5rem;
      transition: all 0.3s ease;
    }

    .btn-gradient:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(238,9,121,0.6), 0 0 20px rgba(255,106,0,0.6);
    }

    .text-truncate {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* ---------- Responsive ---------- */
    @media (max-width: 768px) {
      .product-image {
        height: 200px;
      }
    }
  </style>
</section>
</html>
